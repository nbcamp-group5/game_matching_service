<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <link
      href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css"
      rel="stylesheet"
      id="bootstrap-css"
    />
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
    <link
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
      rel="stylesheet"
      integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
      crossorigin="anonymous"
    />

    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
      integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
      crossorigin="anonymous"
    ></script>
    <link
      href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"
      rel="stylesheet"
      id="bootstrap-css"
    />
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <link rel="stylesheet" href="profile.css" />
    <link rel="stylesheet" href="../menu.css" />
    <script>
      $(document).ready(function () {
        $("#profile-content-box").empty();
        $.ajax({
          type: "GET",
          url: "http://43.200.42.252:8080/api/profile/",
          headers: {
            "Content-Type": "application/json",
            Authorization: localStorage.getItem("Authorization"),
          },
          data: {},
          success: function (response) {
            let nickname = response["nickname"];
            let imageUrl = response["image"];
            let game = response["game"];
            if (game == null) {
              game = "-";
            }
            let tier = response["tier"];
            if (tier == null) {
              tier = "-";
            }
            let mannerPoints = response["mannerPoints"];
            let email = response["email"];

            let temp = ` <div class="panels panel-info profile-box-1">
                        
                        <div id="profile-content-box" class="panel-body-1">
                            <div class="row">
                                <div id="panel-body__img-box">
                                    <img src="https://game-matching.s3.ap-northeast-2.amazonaws.com/${imageUrl}"/>
                                </div>
                                
                                <table class="table table-user-information profile-box__info">
                                    <tbody>
                                        <tr>
                                            <td>ë‹‰ë„¤ì„</td>
                                            <td>${nickname}</td>
                                        </tr>
                                        <tr>
                                            <td>ë§¤ë„ˆ ì ìˆ˜</td>
                                            <td>${mannerPoints}</td>
                                        </tr>
                                        <tr>
                                            <td>í‹°ì–´</td>
                                            <td>${tier}</td>
                                        </tr>
                                    
                                        <tr>
                                            <td>ê´€ì‹¬ ê²Œì„</td>
                                            <td>${game}</td>
                                        </tr>
                                        <tr>
                                            <td>Email</td>
                                            <td><a href="mailto:${email}"></a>${email}</td>
                                        </tr>
                                            
                                        </tr>
                                    
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>`;
            $("#profile-content-box").append(temp);
          },
        });
      });
    </script>
  </head>

  <body>
    <nav
      class="navbar navbar-light bg-white"
      style="z-index: 1; justify-content: flex-start"
    >
      <img href="#" class="" src="/images/common/logo.png" />
    </nav>

  <nav class="navbar navbar-light bg-white" style="z-index: 1; justify-content: flex-start;">
    <img href="#" class="" src="../images/nav/logo.png" />
  </nav>

        <li class="menu__btn">
          <a class="menu__link" href="/templates/board/anonymous-board.html">
            <div class="menu__link__explain">
              <!-- <span><i class="fa-solid fa-clipboard-question fa-lg"></i></span> -->
              <span>ğŸ“ ìµëª… ê²Œì‹œíŒ</span>
            </div>
          </a>
        </li>

  <nav class="menu">
    <div class="menu__list">
      <li class="menu__btn">
        <a class="menu__link" href="/board/board.html">
          <div class="menu__link__explain">
            <!-- <span><i class="fa-solid fa-clipboard-user fa-lg"></i></span> -->
            <span>ğŸ“ ì¼ë°˜ ê²Œì‹œíŒ</span>
          </div>
        </a>
      </li>

      <li class="menu__btn">
        <a class="menu__link" href="/board/anonymous-board.html">
          <div class="menu__link__explain">
            <!-- <span><i class="fa-solid fa-clipboard-question fa-lg"></i></span> -->
            <span>ğŸ“ ìµëª… ê²Œì‹œíŒ</span>
          </div>
        </a>
      </li>

      <li class="menu__btn">
        <a class="menu__link" href="/chat/chat.html">
          <div class="menu__link__explain">
            <!-- <span><i class="fa-solid fa-comment fa-lg"></i></span> -->
            <span>âœ‰ï¸ ë©”ì‹œì§€</span>
          </div>
        </a>
      </li>

      <li class="menu__btn">
        <a class="menu__link" href="/matching/matching-request.html">
          <div class="menu__link__explain">
            <!-- <span><i class="fa-solid fa-gamepad"></i></span> -->
            <span>ğŸ® ë§¤ì¹­</span>
          </div>
        </a>
      </li>

      <li class="menu__btn" style="background-color: #b1bce66c;">
        <a class="menu__link" href="/profile/my-profile.html">
          <div class="menu__link__explain">
            <!-- <i class="fa-solid fa-user fa-lg"></i> -->
            <span>ğŸ™‡ğŸ»â€â™€ï¸ í”„ë¡œí•„</span>
          </div>
        </a>
      </li>
    </div>
  </nav>

  <script src="https://kit.fontawesome.com/0f7e35127c.js" crossorigin="anonymous"></script>

  <div class="container">
    <div class="row" id="profile-outer-box">
      <div class="col-md-5  toppad  pull-right col-md-offset-3 ">
        <A href="edit-profile.html" style="margin-left: 7px; color: #9A86A4;">í”„ë¡œí•„ ìˆ˜ì •</A>

        <A href="edit.html" style="color: #9A86A4; margin-left: 10px;">ë¡œê·¸ì•„ì›ƒ</A>

        <li class="menu__btn" style="background-color: #b1bce66c">
          <a class="menu__link" href="/templates/profile/my-profile.html">
            <div class="menu__link__explain">
              <!-- <i class="fa-solid fa-user fa-lg"></i> -->
              <span>ğŸ™‡ğŸ»â€â™€ï¸ í”„ë¡œí•„</span>
            </div>
          </a>
        </li>
      </div>
    </nav>

    <script
      src="https://kit.fontawesome.com/0f7e35127c.js"
      crossorigin="anonymous"
    ></script>

    <div class="container">
      <div class="row" id="profile-outer-box">
        <div class="col-md-5 toppad pull-right col-md-offset-3">
          <a href="edit-profile.html" style="margin-left: 7px; color: #9a86a4"
            >í”„ë¡œí•„ ìˆ˜ì •</a
          >

          <a href="edit.html" style="color: #9a86a4; margin-left: 10px"
            >ë¡œê·¸ì•„ì›ƒ</a
          >
        </div>
        <div
          class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xs-offset-0 col-sm-offset-0 col-md-offset-3 col-lg-offset-3 toppad"
        >
          <div
            class="panels panel-info profile-box"
            style="margin-bottom: 0px; border-radius: 10px"
          >
            <div id="profile-content-box" class="panel-body">
              <!-- ë‚´ìš© ë“¤ì–´ì˜¤ëŠ” ê³³ -->
            </div>
          </div>
          <div class="more-suggestions">
            <div class="more-suggestions__menu">
              <a id="friend" onclick="showBuddy()" href="#">ë‚´ ì¹œêµ¬</a>
            </div>
            <div class="more-suggestions__menu">
              <a id="board" onclick="showBoard()" href="#">ë‚´ ê²Œì‹œê¸€</a>
            </div>
            <div class="more-suggestions__menu">
              <a id="match" onclick="showMatch()" href="#">ë‚´ ë§¤ì¹­</a>
            </div>
            <div class="more-suggestions__menu">
              <a id="fapply" onclick="showApply()" href="#">ì¹œêµ¬ ì‹ ì²­</a>
            </div>
          </div>

          <div class="wells table-box" id="pfbox" style="display: none">
            <table class="table user-table" id="users-box-contents"></table>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
<script>
  function showBuddy() {
    $(`#users-box-contents`).empty();
    const box = document.getElementById("pfbox");
    box.style.display = "flex";

    $.ajax({
      type: "GET",
      url: "http://43.200.42.252:8080/api/profile/buddies",
      headers: {
        "Content-Type": "application/json",
        Authorization: localStorage.getItem("Authorization"),
      },
      data: {},
      success: function (response) {
        let ttemp = `<thead>
                <tr>
                  <th>-</th>
                  <th class="more-suggestions__list__user-table">ë‹‰ë„¤ì„</th>
                  <th class="more-suggestions__list__user-table">í‹°ì–´</th>
                  <th class="more-suggestions__list__user-table">ë§¤ë„ˆì ìˆ˜</th>
                  <th></th>
                  <th>-</th>
                  <th>-</th>
                </tr>
              </thead>`;

        $("#users-box-contents").append(ttemp);

        $(response).each(function () {
          let temp = `<tbody><tr>
                    <td>1</td>
                    <td>${this.nickname}</td>
                    <td>${this.tier}</td>
                    <td>-${this.mannerPoints}</td>
                    <td>
                      <a href="other-profile.html?userId=${this.id}" class="more-suggestions__list__btn">í”„ë¡œí•„ ë³´ê¸°</a>
                      <a onclick="deleteBuddy(${this.id})" class="more-suggestions__list__btn">ì¹œêµ¬ ì‚­ì œ</a>
                    </td>
                  </tr></tbody>`;

          $("#users-box-contents").append(temp);
        });
      },
    });
  }

  function showBoard() {
    $(`#users-box-contents`).empty();
    const box = document.getElementById("pfbox");
    box.style.display = "flex";

    $.ajax({
      type: "GET",
      url: "http://43.200.42.252:8080/api/profile/boards",
      headers: {
        "Content-Type": "application/json",
        Authorization: localStorage.getItem("Authorization"),
      },
      data: {},
      success: function (response) {
        let ttemp = `<thead>
                <tr>
                  <th>-</th>
                  <th class="more-suggestions__list__user-table">ì´ë¯¸ì§€</th>
                  <th class="more-suggestions__list__user-table">ê²Œì‹œê¸€ ID</th>
                  <th class="more-suggestions__list__user-table">ì‘ì„±ì</th>
                  <th class="more-suggestions__list__user-table">ë‚´ìš©</th>
                  <th></th>
                </tr>
              </thead>`;

        $("#users-box-contents").append(ttemp);

        $(response).each(function () {
          let temp = `<tr>
                      <td>1</td>
                      <td>
                        <img class="list-picture" src="localhost:8080/resources/static/files/${this.boardImageUrl}">
                      </td>
                      <td>${this.id}</td>
                      <td>${this.nickname}</td>
                      <td>${this.contents}</td>
                    </tr>`
          $("#users-box-contents").append(temp);
        })
      }
    })
  }

  function showMatch() {

    $(`#users-box-contents`).empty();
    const box = document.getElementById("pfbox");
    box.style.display = "flex";

    

  }

  function showApply() {
    $(`#users-box-contents`).empty();
    const box = document.getElementById("pfbox");
    box.style.display = "flex";

    $.ajax({
      type: "GET",
      url: "http://43.200.42.252:8080/api/profile/notYetBuddies",
      headers: {
        "Content-Type": "application/json",
        Authorization: localStorage.getItem("Authorization"),
      },
      data: {},
      success: function (response) {
        let ttemp = `<thead>
                <tr>
                  <th>-</th>
                  <th class="more-suggestions__list__user-table">-</th>
                  <th class="more-suggestions__list__user-table">ë‹‰ë„¤ì„</th>
                  <th></th>
                </tr>
              </thead>`;

        $("#users-box-contents").append(ttemp);

        $(response).each(function () {
          let temp = `<tr>
                    <td>1</td>
                    <td>
                      <img class="list-picture" src="https://www.urbanbrush.net/en/wp-content/uploads/edd/2022/11/urbanbrush-20221112181833147836.jpg"> 
                    </td>
                    <td>${this.nickname}</td>
                    <td>
                      <a type='button' onclick="accept(${this.id});" class="more-suggestions__list__btn">ìˆ˜ë½í•˜ê¸°</a>
                      <a type='button' href="#" onclick="decline(${this.id});" class="more-suggestions__list__btn">ê±°ì ˆí•˜ê¸°</a>
                    </td>
                  </tr>`;

          $("#user-box-contents").append(temp);
        });
      },
    });
  }

  function accept(id) {
    $.ajax({
      type: "POST",
      url: "http://43.200.42.252:8080/api/profile/notYetBuddies",
      headers: {
        "Content-Type": "application/json",
        Authorization: localStorage.getItem("Authorization"),
      },
      data: JSON.stringify({
        requestMemberId: id,
        answer: true,
      }),
      success: function (response) {
        window.location.href = "profile-mybuddies.html";
      },
    });
  }

  function decline(id) {
    $.ajax({
      type: "POST",
      url: "http://43.200.42.252:8080/api/profile/notYetBuddies",
      headers: {
        "Content-Type": "application/json",
        Authorization: localStorage.getItem("Authorization"),
      },
      data: JSON.stringify({
        requestMemberId: id,
        answer: false,
      }),
      success: function (response) {
        window.location.href = "profile-mybuddies.html";
      },
    });
  }
</script>
